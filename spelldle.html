<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelldle</title>
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Color scheme variables */
        :root {
            --green: #6aaa64;
            --yellow: #c9b458;
            --gray: #787c7e;
            --dark-bg: #121213;
            --dark-text: #ffffff;
            --dark-border: #3a3a3c;
        }

        /* Dark theme styling */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* Progress counter styling */
        .progress-counter {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Main game container */
        .game-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* Start button styling */
        .start-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .start-button:hover {
            background-color: #5a9a54;
        }

        .start-button:active {
            background-color: #4a8a44;
        }

        /* Audio controls styling */
        .audio-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .repeat-button {
            background-color: var(--gray);
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .repeat-button:hover {
            background-color: #686c6f;
        }

        .repeat-button:active {
            background-color: #585c5f;
        }

        .repeat-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .audio-fallback {
            background-color: #444;
            color: var(--yellow);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            margin: 10px 0;
        }

        /* Initial guess input styling */
        .initial-guess-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .guess-input {
            background-color: var(--dark-bg);
            color: var(--dark-text);
            border: 2px solid var(--dark-border);
            padding: 12px 16px;
            font-size: 16px;
            border-radius: 6px;
            min-width: 200px;
            text-align: center;
            font-family: inherit;
        }

        .guess-input:focus {
            outline: none;
            border-color: var(--green);
        }

        .submit-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .submit-button:hover {
            background-color: #5a9a54;
        }

        .submit-button:active {
            background-color: #4a8a44;
        }

        .submit-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .validation-message {
            color: var(--yellow);
            font-size: 14px;
            text-align: center;
            margin-top: 5px;
        }

        /* Game completion styling */
        .game-complete-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .game-complete-message {
            font-size: 24px;
            font-weight: bold;
            color: var(--green);
        }

        .play-again-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .play-again-button:hover {
            background-color: #5a9a54;
        }

        .play-again-button:active {
            background-color: #4a8a44;
        }

        /* Clue phase feedback styling */
        .clue-phase-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            width: 100%;
        }

        .feedback-row {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 5px 0;
        }

        .letter-box {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border: 3px solid #000;
            border-radius: 3px;
            font-weight: bold;
            font-size: 18px;
            text-transform: uppercase;
            box-sizing: border-box;
            vertical-align: top;
        }

        .letter-box.green {
            background-color: var(--green);
            color: white;
        }

        .letter-box.yellow {
            background-color: var(--yellow);
            color: white;
        }

        .letter-box.gray {
            background-color: var(--gray);
            color: white;
        }

        .letter-box.extraneous {
            border: 3px dotted #000;
        }

        .letter-box.missing {
            background-color: transparent;
            border: 3px solid #000;
            color: var(--dark-text);
        }

        /* Clue phase input styling */
        .input-row-clue {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 10px 0;
        }

        .letter-input {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border: 3px solid #000;
            border-radius: 3px;
            font-weight: bold;
            font-size: 18px;
            text-transform: lowercase;
            box-sizing: border-box;
            text-align: center;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            font-family: inherit;
        }

        .letter-input:focus {
            outline: none;
            border-color: var(--green);
        }

        .clue-submit-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        .clue-submit-button:hover {
            background-color: #5a9a54;
        }

        .clue-submit-button:active {
            background-color: #4a8a44;
        }

        .clue-submit-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                max-width: 100%;
                padding: 15px;
            }
            
            .progress-counter {
                font-size: 16px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .game-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="progress-counter" id="progressCounter">Word 1 of 12</div>
    
    <div class="game-container" id="gameContainer">
        <button class="start-button" id="startButton" onclick="initializeGame()">Start Game</button>
        <div class="audio-controls" id="audioControls" style="display: none;">
            <button class="repeat-button" id="repeatButton" onclick="repeatWord()" disabled>Repeat Word</button>
        </div>
        <div class="audio-fallback" id="audioFallback" style="display: none;">
            Audio not supported in this browser
        </div>
        
        <div class="initial-guess-container" id="initialGuessContainer" style="display: none;">
            <div class="input-row">
                <input 
                    type="text" 
                    class="guess-input" 
                    id="guessInput" 
                    placeholder="Type your guess..."
                    spellcheck="false"
                    autocomplete="off"
                    onkeydown="handleInputKeydown(event)"
                    oninput="handleInputChange(event)"
                />
                <button class="submit-button" id="submitButton" onclick="submitGuess()">Submit</button>
            </div>
            <div class="validation-message" id="validationMessage"></div>
        </div>
        
        <div class="clue-phase-container" id="cluePhaseContainer" style="display: none;">
            <!-- Feedback rows will be dynamically added here -->
        </div>
        
        <div class="game-complete-container" id="gameCompleteContainer" style="display: none;">
            <div class="game-complete-message">Game Complete!</div>
            <button class="play-again-button" onclick="playAgain()">Play Again</button>
        </div>
    </div>

    <script>
        // Word list with example sentences
        const wordList = [
            { word: "friend", sentence: "She is my best friend." },
            { word: "bright", sentence: "The sun is very bright today." },
            { word: "school", sentence: "I walk to school every morning." },
            { word: "enough", sentence: "We have enough food for dinner." },
            { word: "through", sentence: "The ball went through the window." },
            { word: "because", sentence: "I stayed home because I was sick." },
            { word: "different", sentence: "Each snowflake is different." },
            { word: "beautiful", sentence: "The sunset was beautiful tonight." },
            { word: "important", sentence: "It's important to brush your teeth." },
            { word: "knowledge", sentence: "Reading books increases your knowledge." },
            { word: "rhythm", sentence: "The music has a steady rhythm." },
            { word: "necessary", sentence: "Sleep is necessary for good health." }
        ];

        // Game state variables
        const gameState = {
            currentWordIndex: 0,
            currentPhase: 'initial', // 'initial' or 'clue'
            totalWords: wordList.length,
            currentWord: null,
            currentSentence: null,
            gameStarted: false
        };

        // Text-to-speech variables
        let ttsSupported = false;
        let currentUtterance = null;
        let synth = null;

        /**
         * Spelling Evaluator namespace containing all evaluation functions
         */
        const SpellingEvaluator = {
            /**
             * Marks length differences between guess and target words.
             * Handles cases where guess is longer (extraneous letters) or shorter (missing letters) than target.
             * @param {number} guessLength - Length of the guess word
             * @param {number} targetLength - Length of the target word
             * @param {Object} result - Result object containing feedback, extraneous, and missing arrays
             * @private
             */
            _markLengthDifferences(guessLength, targetLength, result) {
                if (guessLength > targetLength) {
                    // Mark extra letters as extraneous
                    for (let i = targetLength; i < guessLength; i++) {
                        result.extraneous[i] = true;
                    }
                } else if (guessLength < targetLength) {
                    // Mark missing positions
                    for (let i = guessLength; i < targetLength; i++) {
                        result.feedback[i] = 'missing';
                        result.missing[i] = true;
                    }
                }
            },

            /**
             * Processes exact position matches between guess and target (green letters).
             * Only checks the overlapping portion of both words for character-by-character matches.
             * @param {string} guess - The guessed word
             * @param {string} target - The target word
             * @param {Object} result - Result object containing the feedback array
             * @param {boolean[]} targetUsed - Array tracking which target positions have been matched
             * @param {boolean[]} guessUsed - Array tracking which guess positions have been matched
             * @private
             */
            _processExactMatches(guess, target, result, targetUsed, guessUsed) {
                const overlapLength = Math.min(guess.length, target.length);
                
                for (let i = 0; i < overlapLength; i++) {
                    if (guess[i] === target[i]) {
                        result.feedback[i] = 'green';
                        targetUsed[i] = true;
                        guessUsed[i] = true;
                    }
                }
            },

            /**
             * Processes wrong position matches between guess and target (yellow letters).
             * Finds letters that exist in target but are in wrong positions in guess.
             * Only processes letters not already matched in exact positions.
             * @param {string} guess - The guessed word
             * @param {string} target - The target word
             * @param {Object} result - Result object containing the feedback array
             * @param {boolean[]} targetUsed - Array tracking which target positions have been matched
             * @param {boolean[]} guessUsed - Array tracking which guess positions have been matched
             * @private
             */
            _processWrongPositions(guess, target, result, targetUsed, guessUsed) {
                for (let i = 0; i < guess.length; i++) {
                    if (guessUsed[i]) continue; // Already matched as green
                    
                    for (let j = 0; j < target.length; j++) {
                        if (!targetUsed[j] && guess[i] === target[j]) {
                            result.feedback[i] = 'yellow';
                            targetUsed[j] = true;
                            guessUsed[i] = true;
                            break; // Only match one occurrence
                        }
                    }
                }
            },

            /**
             * Evaluates a spelling guess against a target word.
             * Returns an object with:
             *   - feedback: array of 'green', 'yellow', 'gray', or 'missing'
             *   - extraneous: array of booleans (true for extraneous letters)
             *   - missing: array of booleans (true for missing letter positions)
             * @param {string} guess - The word being guessed
             * @param {string} target - The target word to match against
             * @returns {Object} { feedback: string[], extraneous: boolean[], missing: boolean[] }
             */
            evaluate(guess, target) {
                const guessLength = guess.length;
                const targetLength = target.length;
                const maxLength = Math.max(guessLength, targetLength);
                
                // Initialize result object and tracking arrays
                const result = {
                    feedback: Array(maxLength).fill('gray'),
                    extraneous: Array(maxLength).fill(false),
                    missing: Array(maxLength).fill(false)
                };
                
                const targetUsed = Array(targetLength).fill(false);
                const guessUsed = Array(guessLength).fill(false);

                // Process evaluation in logical steps
                this._markLengthDifferences(guessLength, targetLength, result);
                this._processExactMatches(guess, target, result, targetUsed, guessUsed);
                this._processWrongPositions(guess, target, result, targetUsed, guessUsed);

                return result;
            },

            /**
             * Checks if the guess is a win (exact match: case, length, content).
             * @param {string} guess - The guessed word
             * @param {string} target - The target word
             * @returns {boolean} True if guess exactly matches target
             */
            isWin(guess, target) {
                return guess === target;
            }
        };

        // Check for text-to-speech support
        function checkTTSSupport() {
            if ('speechSynthesis' in window) {
                synth = window.speechSynthesis;
                ttsSupported = true;
                console.log('Text-to-speech supported');
            } else {
                ttsSupported = false;
                console.log('Text-to-speech not supported');
                showAudioFallback();
            }
        }

        // Show audio fallback message
        function showAudioFallback() {
            const fallbackDiv = document.getElementById('audioFallback');
            fallbackDiv.style.display = 'block';
        }

        // Create speech utterance with pause between word and sentence
        function createUtterance(word, sentence) {
            if (!ttsSupported) return null;
            
            // Create text with slight pause between word and sentence
            const textToSpeak = `${word}... ${sentence}`;
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            
            // Use browser default voice at normal rate
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Handle TTS errors gracefully
            utterance.onerror = function(event) {
                console.error('Speech synthesis error:', event.error);
            };
            
            return utterance;
        }

        // Speak the current word and sentence
        function speakCurrentWord() {
            if (!ttsSupported || !gameState.currentWord || !gameState.currentSentence) {
                return;
            }
            
            // Stop any current speech
            if (synth.speaking) {
                synth.cancel();
            }
            
            // Create and cache the utterance
            currentUtterance = createUtterance(gameState.currentWord, gameState.currentSentence);
            
            if (currentUtterance) {
                // Enable repeat button when speech starts
                const repeatButton = document.getElementById('repeatButton');
                repeatButton.disabled = false;
                
                synth.speak(currentUtterance);
                console.log(`Speaking: ${gameState.currentWord}... ${gameState.currentSentence}`);
            }
        }

        // Repeat the current word (replays same cached audio)
        function repeatWord() {
            if (!ttsSupported || !currentUtterance) {
                return;
            }
            
            // Stop any current speech
            if (synth.speaking) {
                synth.cancel();
            }
            
            // Replay the same cached utterance
            synth.speak(currentUtterance);
            console.log('Repeating word');
        }

        // Speak "Correct!" announcement
        function speakCorrect() {
            if (!ttsSupported) return;
            
            const correctUtterance = new SpeechSynthesisUtterance('Correct!');
            correctUtterance.rate = 1.0;
            correctUtterance.pitch = 1.0;
            correctUtterance.volume = 1.0;
            
            correctUtterance.onerror = function(event) {
                console.error('Speech synthesis error:', event.error);
            };
            
            if (synth.speaking) {
                synth.cancel();
            }
            
            synth.speak(correctUtterance);
        }

        // Handle input field keydown events
        function handleInputKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitGuess();
            }
        }

        // Handle input changes for case handling
        function handleInputChange(event) {
            const input = event.target;
            const value = input.value;
            
            // Clear any validation messages when user starts typing
            clearValidationMessage();
            
            // Convert to lowercase unless Caps Lock or Shift is engaged
            if (!event.getModifierState || (!event.getModifierState('CapsLock') && !event.getModifierState('Shift'))) {
                // Only convert if the last character added was uppercase
                const lastChar = value.slice(-1);
                if (lastChar && lastChar === lastChar.toUpperCase() && lastChar !== lastChar.toLowerCase()) {
                    input.value = value.slice(0, -1) + lastChar.toLowerCase();
                }
            }
        }

        // Show validation message
        function showValidationMessage(message) {
            const validationDiv = document.getElementById('validationMessage');
            validationDiv.textContent = message;
        }

        // Clear validation message
        function clearValidationMessage() {
            const validationDiv = document.getElementById('validationMessage');
            validationDiv.textContent = '';
        }

        // Submit the current guess
        function submitGuess() {
            const input = document.getElementById('guessInput');
            const guess = input.value.trim();
            
            // Prevent empty submissions
            if (!guess) {
                showValidationMessage('Please enter a guess before submitting.');
                input.focus();
                return;
            }
            
            clearValidationMessage();
            console.log(`User guessed: "${guess}" for target: "${gameState.currentWord}"`);
            
            // Case-sensitive word comparison
            if (guess === gameState.currentWord) {
                // Correct guess - play "Correct!" and advance to next word
                handleCorrectGuess();
            } else {
                // Incorrect guess - transition to Clue Phase
                handleIncorrectGuess(guess);
            }
        }

        // Handle correct guess
        function handleCorrectGuess() {
            console.log('Correct guess!');
            
            // Play "Correct!" via text-to-speech
            speakCorrect();
            
            // Advance to next word after brief delay
            setTimeout(() => {
                advanceToNextWord();
            }, 1500); // 1.5 second delay to let "Correct!" play
        }

        // Handle incorrect guess
        function handleIncorrectGuess(guess) {
            console.log(`Incorrect guess: "${guess}"`);
            
            // Transition to Clue Phase (don't clear screen)
            gameState.currentPhase = 'clue';
            
            // Hide the initial guess input
            hideInitialGuessInput();
            
            // Show clue phase feedback
            showCluePhase(guess);
        }

        // Clear and focus the input field
        function clearAndFocusInput() {
            const input = document.getElementById('guessInput');
            input.value = '';
            clearValidationMessage();
            input.focus();
        }

        // Show the initial guess input
        function showInitialGuessInput() {
            const container = document.getElementById('initialGuessContainer');
            container.style.display = 'flex';
            
            // Focus the input field after a brief delay
            setTimeout(() => {
                clearAndFocusInput();
            }, 100);
        }

        // Hide the initial guess input
        function hideInitialGuessInput() {
            const container = document.getElementById('initialGuessContainer');
            container.style.display = 'none';
        }

        // Render feedback boxes from SpellingEvaluator results
        function renderFeedbackBoxes(guess, target, evaluation) {
            const { feedback, extraneous, missing } = evaluation;
            const boxes = [];
            
            for (let i = 0; i < feedback.length; i++) {
                const letter = missing[i] ? '' : (guess[i] || '');
                const colorClass = feedback[i];
                const extraneousClass = extraneous[i] ? ' extraneous' : '';
                const missingClass = missing[i] ? ' missing' : '';
                
                boxes.push(`<div class="letter-box ${colorClass}${extraneousClass}${missingClass}">${letter}</div>`);
            }
            
            return boxes.join('');
        }

        // Show the clue phase with feedback
        function showCluePhase(guess) {
            const container = document.getElementById('cluePhaseContainer');
            container.style.display = 'flex';
            
            // Evaluate the guess using SpellingEvaluator
            const evaluation = SpellingEvaluator.evaluate(guess, gameState.currentWord);
            console.log('Evaluation result:', evaluation);
            
            // Create feedback row
            const feedbackRow = document.createElement('div');
            feedbackRow.className = 'feedback-row';
            feedbackRow.innerHTML = renderFeedbackBoxes(guess, gameState.currentWord, evaluation);
            
            // Add the feedback row to the container
            container.appendChild(feedbackRow);
            
            // Add input row for next guess
            addInputRow(container);
            
            console.log(`Displayed feedback for guess: "${guess}" vs target: "${gameState.currentWord}"`);
        }

        // Add input row with individual letter boxes
        function addInputRow(container) {
            const inputRowContainer = document.createElement('div');
            inputRowContainer.className = 'input-row-container';
            
            // Create input row
            const inputRow = document.createElement('div');
            inputRow.className = 'input-row-clue';
            
            // Create individual input fields for each letter in target word
            for (let i = 0; i < gameState.currentWord.length; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'letter-input';
                input.maxLength = 1;
                input.dataset.index = i;
                input.addEventListener('input', handleLetterInput);
                input.addEventListener('keydown', handleLetterKeydown);
                inputRow.appendChild(input);
            }
            
            inputRowContainer.appendChild(inputRow);
            
            // Create submit button
            const submitButton = document.createElement('button');
            submitButton.className = 'clue-submit-button';
            submitButton.textContent = 'Submit';
            submitButton.onclick = submitClueGuess;
            inputRowContainer.appendChild(submitButton);
            
            container.appendChild(inputRowContainer);
            
            // Auto-focus first input box
            const firstInput = inputRow.querySelector('.letter-input');
            if (firstInput) {
                setTimeout(() => firstInput.focus(), 100);
            }
        }

        // Handle input in letter boxes
        function handleLetterInput(event) {
            const input = event.target;
            const value = input.value;
            
            // Convert to lowercase unless Caps Lock or Shift is engaged
            if (value && !event.getModifierState || (!event.getModifierState('CapsLock') && !event.getModifierState('Shift'))) {
                if (value === value.toUpperCase() && value !== value.toLowerCase()) {
                    input.value = value.toLowerCase();
                }
            }
            
            // Move to next box if letter was entered
            if (value) {
                const currentIndex = parseInt(input.dataset.index);
                const nextInput = input.parentElement.querySelector(`[data-index="${currentIndex + 1}"]`);
                if (nextInput) {
                    nextInput.focus();
                }
            }
        }

        // Handle keydown events in letter boxes
        function handleLetterKeydown(event) {
            const input = event.target;
            const currentIndex = parseInt(input.dataset.index);
            
            if (event.key === 'Backspace') {
                // If current box is empty, move to previous box
                if (!input.value && currentIndex > 0) {
                    const prevInput = input.parentElement.querySelector(`[data-index="${currentIndex - 1}"]`);
                    if (prevInput) {
                        prevInput.focus();
                    }
                }
            } else if (event.key === 'Enter') {
                event.preventDefault();
                submitClueGuess();
            } else if (event.key === 'ArrowLeft' && currentIndex > 0) {
                const prevInput = input.parentElement.querySelector(`[data-index="${currentIndex - 1}"]`);
                if (prevInput) {
                    prevInput.focus();
                }
            } else if (event.key === 'ArrowRight' && currentIndex < gameState.currentWord.length - 1) {
                const nextInput = input.parentElement.querySelector(`[data-index="${currentIndex + 1}"]`);
                if (nextInput) {
                    nextInput.focus();
                }
            }
        }

        // Submit clue phase guess
        function submitClueGuess() {
            const container = document.getElementById('cluePhaseContainer');
            const lastInputRow = container.querySelector('.input-row-container:last-child .input-row-clue');
            const inputs = lastInputRow.querySelectorAll('.letter-input');
            
            // Collect letters from input boxes
            let guess = '';
            let allFilled = true;
            
            inputs.forEach(input => {
                const value = input.value.trim();
                if (!value) {
                    allFilled = false;
                }
                guess += value;
            });
            
            // Prevent submission if not all boxes are filled
            if (!allFilled) {
                // Find first empty input and focus it
                const firstEmpty = Array.from(inputs).find(input => !input.value.trim());
                if (firstEmpty) {
                    firstEmpty.focus();
                }
                return;
            }
            
            console.log(`Clue phase guess: "${guess}" for target: "${gameState.currentWord}"`);
            
            // Check if guess is correct
            if (guess === gameState.currentWord) {
                // Correct guess - play "Correct!" and advance to next word
                handleCorrectGuess();
            } else {
                // Incorrect guess - add new feedback row and input row
                handleIncorrectClueGuess(guess);
            }
        }

        // Handle incorrect guess in clue phase
        function handleIncorrectClueGuess(guess) {
            console.log(`Incorrect clue guess: "${guess}"`);
            
            const container = document.getElementById('cluePhaseContainer');
            
            // Evaluate the guess using SpellingEvaluator
            const evaluation = SpellingEvaluator.evaluate(guess, gameState.currentWord);
            console.log('Clue evaluation result:', evaluation);
            
            // Create new feedback row
            const feedbackRow = document.createElement('div');
            feedbackRow.className = 'feedback-row';
            feedbackRow.innerHTML = renderFeedbackBoxes(guess, gameState.currentWord, evaluation);
            
            // Add the feedback row to the container
            container.appendChild(feedbackRow);
            
            // Add new input row for next attempt
            addInputRow(container);
        }

        // Hide the clue phase
        function hideCluePhase() {
            const container = document.getElementById('cluePhaseContainer');
            container.style.display = 'none';
            // Clear all feedback rows
            container.innerHTML = '';
        }

        // Get current word data
        function getCurrentWordData() {
            if (gameState.currentWordIndex < wordList.length) {
                return wordList[gameState.currentWordIndex];
            }
            return null;
        }

        // Update progress counter display
        function updateProgressCounter() {
            const progressCounter = document.getElementById('progressCounter');
            progressCounter.textContent = `Word ${gameState.currentWordIndex + 1} of ${gameState.totalWords}`;
        }

        // Advance to next word
        function advanceToNextWord() {
            gameState.currentWordIndex++;
            if (gameState.currentWordIndex < gameState.totalWords) {
                // Reset to Initial Guess Phase for new word
                gameState.currentPhase = 'initial';
                const wordData = getCurrentWordData();
                gameState.currentWord = wordData.word;
                gameState.currentSentence = wordData.sentence;
                updateProgressCounter();
                
                // Hide clue phase and show initial guess input for new word
                hideCluePhase();
                showInitialGuessInput();
                
                // Auto-play the new word
                setTimeout(() => {
                    speakCurrentWord();
                }, 500); // Brief delay before speaking
                
                console.log(`Advanced to word ${gameState.currentWordIndex + 1}: ${gameState.currentWord}`);
            } else {
                // Handle game completion (after word 12)
                handleGameCompletion();
            }
        }

        // Handle game completion
        function handleGameCompletion() {
            console.log('Game completed!');
            
            // Hide any remaining game elements
            hideInitialGuessInput();
            hideCluePhase();
            
            // Show game complete message and play again button
            const gameCompleteContainer = document.getElementById('gameCompleteContainer');
            gameCompleteContainer.style.display = 'flex';
        }

        // Play again functionality
        function playAgain() {
            console.log('Starting new game');
            
            // Reset game state to word 1
            gameState.currentWordIndex = 0;
            gameState.currentPhase = 'initial';
            gameState.gameStarted = true;
            
            const wordData = getCurrentWordData();
            gameState.currentWord = wordData.word;
            gameState.currentSentence = wordData.sentence;
            
            // Update progress counter
            updateProgressCounter();
            
            // Hide game complete container and clue phase
            const gameCompleteContainer = document.getElementById('gameCompleteContainer');
            gameCompleteContainer.style.display = 'none';
            hideCluePhase();
            
            // Show initial guess input
            showInitialGuessInput();
            
            // Auto-play the first word
            setTimeout(() => {
                speakCurrentWord();
            }, 500);
        }

        // Initialize the game
        function initializeGame() {
            gameState.gameStarted = true;
            gameState.currentWordIndex = 0;
            gameState.currentPhase = 'initial';
            
            const wordData = getCurrentWordData();
            gameState.currentWord = wordData.word;
            gameState.currentSentence = wordData.sentence;
            
            updateProgressCounter();
            
            // Hide start button and show audio controls
            const startButton = document.getElementById('startButton');
            startButton.style.display = 'none';
            
            const audioControls = document.getElementById('audioControls');
            audioControls.style.display = 'flex';
            
            // Show initial guess input
            showInitialGuessInput();
            
            // Auto-play the first word
            setTimeout(() => {
                speakCurrentWord();
            }, 500); // Brief delay to let UI update
            
            console.log('Game initialized');
            console.log(`Current word: ${gameState.currentWord}`);
            console.log(`Current sentence: ${gameState.currentSentence}`);
        }

        // Initialize the page when it loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Spelldle initialized');
            console.log('Current game state:', gameState);
            updateProgressCounter();
            checkTTSSupport();
            
            // Test SpellingEvaluator integration
            console.log('Testing SpellingEvaluator integration:');
            const testResult = SpellingEvaluator.evaluate('hello', 'world');
            console.log('SpellingEvaluator.evaluate("hello", "world"):', testResult);
            console.log('SpellingEvaluator.isWin("friend", "friend"):', SpellingEvaluator.isWin('friend', 'friend'));
            console.log('SpellingEvaluator.isWin("friend", "fiend"):', SpellingEvaluator.isWin('friend', 'fiend'));
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelldle</title>
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Color scheme variables */
        :root {
            --green: #6aaa64;
            --yellow: #c9b458;
            --gray: #787c7e;
            --dark-bg: #121213;
            --dark-text: #ffffff;
            --dark-border: #3a3a3c;
        }

        /* Dark theme styling */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--dark-bg);
            color: var(--dark-text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* Progress counter styling */
        .progress-counter {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }

        /* Main game container */
        .game-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* Start button styling */
        .start-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .start-button:hover {
            background-color: #5a9a54;
        }

        .start-button:active {
            background-color: #4a8a44;
        }

        /* Audio controls styling */
        .audio-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .repeat-button {
            background-color: var(--gray);
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .repeat-button:hover {
            background-color: #686c6f;
        }

        .repeat-button:active {
            background-color: #585c5f;
        }

        .repeat-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .audio-fallback {
            background-color: #444;
            color: var(--yellow);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            margin: 10px 0;
        }

        /* Initial guess input styling */
        .initial-guess-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .guess-input {
            background-color: var(--dark-bg);
            color: var(--dark-text);
            border: 2px solid var(--dark-border);
            padding: 12px 16px;
            font-size: 16px;
            border-radius: 6px;
            min-width: 200px;
            text-align: center;
            font-family: inherit;
        }

        .guess-input:focus {
            outline: none;
            border-color: var(--green);
        }

        .submit-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .submit-button:hover {
            background-color: #5a9a54;
        }

        .submit-button:active {
            background-color: #4a8a44;
        }

        .submit-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .validation-message {
            color: var(--yellow);
            font-size: 14px;
            text-align: center;
            margin-top: 5px;
        }

        /* Game completion styling */
        .game-complete-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .game-complete-message {
            font-size: 24px;
            font-weight: bold;
            color: var(--green);
        }

        .play-again-button {
            background-color: var(--green);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .play-again-button:hover {
            background-color: #5a9a54;
        }

        .play-again-button:active {
            background-color: #4a8a44;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                max-width: 100%;
                padding: 15px;
            }
            
            .progress-counter {
                font-size: 16px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .game-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="progress-counter" id="progressCounter">Word 1 of 12</div>
    
    <div class="game-container" id="gameContainer">
        <button class="start-button" id="startButton" onclick="initializeGame()">Start Game</button>
        <div class="audio-controls" id="audioControls" style="display: none;">
            <button class="repeat-button" id="repeatButton" onclick="repeatWord()" disabled>Repeat Word</button>
        </div>
        <div class="audio-fallback" id="audioFallback" style="display: none;">
            Audio not supported in this browser
        </div>
        
        <div class="initial-guess-container" id="initialGuessContainer" style="display: none;">
            <div class="input-row">
                <input 
                    type="text" 
                    class="guess-input" 
                    id="guessInput" 
                    placeholder="Type your guess..."
                    spellcheck="false"
                    autocomplete="off"
                    onkeydown="handleInputKeydown(event)"
                    oninput="handleInputChange(event)"
                />
                <button class="submit-button" id="submitButton" onclick="submitGuess()">Submit</button>
            </div>
            <div class="validation-message" id="validationMessage"></div>
        </div>
        
        <div class="game-complete-container" id="gameCompleteContainer" style="display: none;">
            <div class="game-complete-message">Game Complete!</div>
            <button class="play-again-button" onclick="playAgain()">Play Again</button>
        </div>
    </div>

    <script>
        // Word list with example sentences
        const wordList = [
            { word: "friend", sentence: "She is my best friend." },
            { word: "bright", sentence: "The sun is very bright today." },
            { word: "school", sentence: "I walk to school every morning." },
            { word: "enough", sentence: "We have enough food for dinner." },
            { word: "through", sentence: "The ball went through the window." },
            { word: "because", sentence: "I stayed home because I was sick." },
            { word: "different", sentence: "Each snowflake is different." },
            { word: "beautiful", sentence: "The sunset was beautiful tonight." },
            { word: "important", sentence: "It's important to brush your teeth." },
            { word: "knowledge", sentence: "Reading books increases your knowledge." },
            { word: "rhythm", sentence: "The music has a steady rhythm." },
            { word: "necessary", sentence: "Sleep is necessary for good health." }
        ];

        // Game state variables
        const gameState = {
            currentWordIndex: 0,
            currentPhase: 'initial', // 'initial' or 'clue'
            totalWords: wordList.length,
            currentWord: null,
            currentSentence: null,
            gameStarted: false
        };

        // Text-to-speech variables
        let ttsSupported = false;
        let currentUtterance = null;
        let synth = null;

        // Check for text-to-speech support
        function checkTTSSupport() {
            if ('speechSynthesis' in window) {
                synth = window.speechSynthesis;
                ttsSupported = true;
                console.log('Text-to-speech supported');
            } else {
                ttsSupported = false;
                console.log('Text-to-speech not supported');
                showAudioFallback();
            }
        }

        // Show audio fallback message
        function showAudioFallback() {
            const fallbackDiv = document.getElementById('audioFallback');
            fallbackDiv.style.display = 'block';
        }

        // Create speech utterance with pause between word and sentence
        function createUtterance(word, sentence) {
            if (!ttsSupported) return null;
            
            // Create text with slight pause between word and sentence
            const textToSpeak = `${word}... ${sentence}`;
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            
            // Use browser default voice at normal rate
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Handle TTS errors gracefully
            utterance.onerror = function(event) {
                console.error('Speech synthesis error:', event.error);
            };
            
            return utterance;
        }

        // Speak the current word and sentence
        function speakCurrentWord() {
            if (!ttsSupported || !gameState.currentWord || !gameState.currentSentence) {
                return;
            }
            
            // Stop any current speech
            if (synth.speaking) {
                synth.cancel();
            }
            
            // Create and cache the utterance
            currentUtterance = createUtterance(gameState.currentWord, gameState.currentSentence);
            
            if (currentUtterance) {
                // Enable repeat button when speech starts
                const repeatButton = document.getElementById('repeatButton');
                repeatButton.disabled = false;
                
                synth.speak(currentUtterance);
                console.log(`Speaking: ${gameState.currentWord}... ${gameState.currentSentence}`);
            }
        }

        // Repeat the current word (replays same cached audio)
        function repeatWord() {
            if (!ttsSupported || !currentUtterance) {
                return;
            }
            
            // Stop any current speech
            if (synth.speaking) {
                synth.cancel();
            }
            
            // Replay the same cached utterance
            synth.speak(currentUtterance);
            console.log('Repeating word');
        }

        // Speak "Correct!" announcement
        function speakCorrect() {
            if (!ttsSupported) return;
            
            const correctUtterance = new SpeechSynthesisUtterance('Correct!');
            correctUtterance.rate = 1.0;
            correctUtterance.pitch = 1.0;
            correctUtterance.volume = 1.0;
            
            correctUtterance.onerror = function(event) {
                console.error('Speech synthesis error:', event.error);
            };
            
            if (synth.speaking) {
                synth.cancel();
            }
            
            synth.speak(correctUtterance);
        }

        // Handle input field keydown events
        function handleInputKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitGuess();
            }
        }

        // Handle input changes for case handling
        function handleInputChange(event) {
            const input = event.target;
            const value = input.value;
            
            // Clear any validation messages when user starts typing
            clearValidationMessage();
            
            // Convert to lowercase unless Caps Lock or Shift is engaged
            if (!event.getModifierState || (!event.getModifierState('CapsLock') && !event.getModifierState('Shift'))) {
                // Only convert if the last character added was uppercase
                const lastChar = value.slice(-1);
                if (lastChar && lastChar === lastChar.toUpperCase() && lastChar !== lastChar.toLowerCase()) {
                    input.value = value.slice(0, -1) + lastChar.toLowerCase();
                }
            }
        }

        // Show validation message
        function showValidationMessage(message) {
            const validationDiv = document.getElementById('validationMessage');
            validationDiv.textContent = message;
        }

        // Clear validation message
        function clearValidationMessage() {
            const validationDiv = document.getElementById('validationMessage');
            validationDiv.textContent = '';
        }

        // Submit the current guess
        function submitGuess() {
            const input = document.getElementById('guessInput');
            const guess = input.value.trim();
            
            // Prevent empty submissions
            if (!guess) {
                showValidationMessage('Please enter a guess before submitting.');
                input.focus();
                return;
            }
            
            clearValidationMessage();
            console.log(`User guessed: "${guess}" for target: "${gameState.currentWord}"`);
            
            // Case-sensitive word comparison
            if (guess === gameState.currentWord) {
                // Correct guess - play "Correct!" and advance to next word
                handleCorrectGuess();
            } else {
                // Incorrect guess - transition to Clue Phase
                handleIncorrectGuess(guess);
            }
        }

        // Handle correct guess
        function handleCorrectGuess() {
            console.log('Correct guess!');
            
            // Play "Correct!" via text-to-speech
            speakCorrect();
            
            // Advance to next word after brief delay
            setTimeout(() => {
                advanceToNextWord();
            }, 1500); // 1.5 second delay to let "Correct!" play
        }

        // Handle incorrect guess
        function handleIncorrectGuess(guess) {
            console.log(`Incorrect guess: "${guess}"`);
            
            // Transition to Clue Phase (don't clear screen)
            gameState.currentPhase = 'clue';
            
            // Hide the initial guess input
            hideInitialGuessInput();
            
            // TODO: Show clue phase feedback in next step
            showValidationMessage('Transitioning to Clue Phase... (Coming in next step)');
        }

        // Clear and focus the input field
        function clearAndFocusInput() {
            const input = document.getElementById('guessInput');
            input.value = '';
            clearValidationMessage();
            input.focus();
        }

        // Show the initial guess input
        function showInitialGuessInput() {
            const container = document.getElementById('initialGuessContainer');
            container.style.display = 'flex';
            
            // Focus the input field after a brief delay
            setTimeout(() => {
                clearAndFocusInput();
            }, 100);
        }

        // Hide the initial guess input
        function hideInitialGuessInput() {
            const container = document.getElementById('initialGuessContainer');
            container.style.display = 'none';
        }

        // Get current word data
        function getCurrentWordData() {
            if (gameState.currentWordIndex < wordList.length) {
                return wordList[gameState.currentWordIndex];
            }
            return null;
        }

        // Update progress counter display
        function updateProgressCounter() {
            const progressCounter = document.getElementById('progressCounter');
            progressCounter.textContent = `Word ${gameState.currentWordIndex + 1} of ${gameState.totalWords}`;
        }

        // Advance to next word
        function advanceToNextWord() {
            gameState.currentWordIndex++;
            if (gameState.currentWordIndex < gameState.totalWords) {
                // Reset to Initial Guess Phase for new word
                gameState.currentPhase = 'initial';
                const wordData = getCurrentWordData();
                gameState.currentWord = wordData.word;
                gameState.currentSentence = wordData.sentence;
                updateProgressCounter();
                
                // Show initial guess input for new word
                showInitialGuessInput();
                
                // Auto-play the new word
                setTimeout(() => {
                    speakCurrentWord();
                }, 500); // Brief delay before speaking
                
                console.log(`Advanced to word ${gameState.currentWordIndex + 1}: ${gameState.currentWord}`);
            } else {
                // Handle game completion (after word 12)
                handleGameCompletion();
            }
        }

        // Handle game completion
        function handleGameCompletion() {
            console.log('Game completed!');
            
            // Hide any remaining game elements
            hideInitialGuessInput();
            
            // Show game complete message and play again button
            const gameCompleteContainer = document.getElementById('gameCompleteContainer');
            gameCompleteContainer.style.display = 'flex';
        }

        // Play again functionality
        function playAgain() {
            console.log('Starting new game');
            
            // Reset game state to word 1
            gameState.currentWordIndex = 0;
            gameState.currentPhase = 'initial';
            gameState.gameStarted = true;
            
            const wordData = getCurrentWordData();
            gameState.currentWord = wordData.word;
            gameState.currentSentence = wordData.sentence;
            
            // Update progress counter
            updateProgressCounter();
            
            // Hide game complete container
            const gameCompleteContainer = document.getElementById('gameCompleteContainer');
            gameCompleteContainer.style.display = 'none';
            
            // Show initial guess input
            showInitialGuessInput();
            
            // Auto-play the first word
            setTimeout(() => {
                speakCurrentWord();
            }, 500);
        }

        // Initialize the game
        function initializeGame() {
            gameState.gameStarted = true;
            gameState.currentWordIndex = 0;
            gameState.currentPhase = 'initial';
            
            const wordData = getCurrentWordData();
            gameState.currentWord = wordData.word;
            gameState.currentSentence = wordData.sentence;
            
            updateProgressCounter();
            
            // Hide start button and show audio controls
            const startButton = document.getElementById('startButton');
            startButton.style.display = 'none';
            
            const audioControls = document.getElementById('audioControls');
            audioControls.style.display = 'flex';
            
            // Show initial guess input
            showInitialGuessInput();
            
            // Auto-play the first word
            setTimeout(() => {
                speakCurrentWord();
            }, 500); // Brief delay to let UI update
            
            console.log('Game initialized');
            console.log(`Current word: ${gameState.currentWord}`);
            console.log(`Current sentence: ${gameState.currentSentence}`);
        }

        // Initialize the page when it loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Spelldle initialized');
            console.log('Current game state:', gameState);
            updateProgressCounter();
            checkTTSSupport();
        });
    </script>
</body>
</html>
